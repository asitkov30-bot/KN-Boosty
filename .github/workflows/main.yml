name: Build Image Gallery

on:
  push:
    paths:
      - 'images/**'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create or update gallery in index.html
        run: |
          # Удаляем существующий контент галереи
          cat <<EOF > index.html
          <!DOCTYPE html>
          <html lang="en">
          <head>
            <meta charset="UTF-8">
            <title>My Image Gallery</title>
            <style>
              .gallery {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 16px;
              }
              .gallery img {
                width: 100%;
                height: auto;
                object-fit: cover;
                border-radius: 8px;
              }
              .copy-url {
                margin-top: 5px;
                padding: 5px 10px;
                background-color: #007bff;
                color: white;
                border: none;
                cursor: pointer;
              }
            </style>
          </head>
          <body>
            <h1>Image Gallery</h1>
            <div class="gallery">
              EOF

          # Проходим по каждому файлу в папке images
          find images/* -type f -exec bash -c '
            echo "  <div>"
            echo "    <img src=\"/$1\">"
            echo "    <button onclick=\"copyURL('$1')\" class=\"copy-url\">Copy URL</button>"
            echo "  </div>"
          ' {} \;

          # Завершаем файл index.html
          cat <<EOF >> index.html
            </div>
            <script>
              function copyURL(url) {
                navigator.clipboard.writeText(location.origin + "/" + url);
                alert("URL copied!");
              }
            </script>
          </body>
          </html>
          EOF

      - name: Commit and Push Changes
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.email "action@github.com"
          git config --global user.name "GitHub Action"
          
          git add .
          git commit -m "Updated gallery automatically by GitHub Actions" || true
          git push origin HEAD:${{ github.ref_name }} || true
